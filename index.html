<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bolsa de Consejeros COIIM - Prototipo</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- FontAwesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        /* Estilos personalizados */
        .exp-bar-bg {
            background-color: #f1f5f9;
            height: 5px;
            border-radius: 3px;
            overflow: hidden;
            margin-top: 3px;
        }
        .exp-bar-fill {
            height: 100%;
            transition: width 0.6s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .card-hover {
            transition: all 0.3s ease;
        }
        .card-hover:hover {
            transform: translateY(-4px);
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 8px 10px -6px rgba(0, 0, 0, 0.1);
        }
        /* Animación para notificaciones */
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        .notification {
            animation: slideIn 0.3s ease-out forwards;
        }
        textarea::-webkit-scrollbar {
            width: 8px;
        }
        textarea::-webkit-scrollbar-track {
            background: #f1f1f1; 
        }
        textarea::-webkit-scrollbar-thumb {
            background: #888; 
            border-radius: 4px;
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-800 font-sans min-h-screen flex flex-col">

    <!-- Navbar -->
    <nav class="bg-blue-900 text-white p-4 shadow-lg sticky top-0 z-40">
        <div class="container mx-auto flex flex-col md:flex-row justify-between items-center gap-4">
            <div class="flex items-center">
                <div class="bg-white text-blue-900 p-2 rounded-lg mr-3">
                    <i class="fa-solid fa-users-viewfinder text-xl"></i>
                </div>
                <div>
                    <h1 class="text-xl font-bold tracking-wider leading-none">CONSEJEROS</h1>
                    <span class="text-xs text-blue-200 tracking-widest">COIIM / BOLSA DE TALENTO</span>
                </div>
            </div>
            
            <div class="flex flex-wrap justify-center gap-3">
                <button onclick="toggleEditMode()" id="btn-mode" class="bg-blue-800 hover:bg-blue-700 border border-blue-700 px-4 py-2 rounded shadow-sm transition text-sm flex items-center">
                    <i class="fa-solid fa-pen-to-square mr-2"></i> Modo Edición
                </button>
                
                <div id="file-actions" class="hidden flex gap-2">
                    <button onclick="exportData()" class="bg-green-600 hover:bg-green-500 px-4 py-2 rounded shadow-sm transition text-sm flex items-center">
                        <i class="fa-solid fa-download mr-2"></i> Guardar JSON
                    </button>
                    <label class="bg-orange-600 hover:bg-orange-500 px-4 py-2 rounded shadow-sm transition text-sm flex items-center cursor-pointer">
                        <i class="fa-solid fa-upload mr-2"></i> Cargar JSON
                        <input type="file" id="file-input" class="hidden" accept=".json" onchange="importData(this)">
                    </label>
                </div>
            </div>
        </div>
    </nav>

    <!-- Filtros -->
    <div class="container mx-auto mt-6 px-4">
        <div class="bg-white rounded-lg shadow-sm border border-slate-200 p-5">
            <div class="flex justify-between items-center mb-4 border-b border-slate-100 pb-2">
                <h2 class="text-sm font-bold text-slate-500 uppercase tracking-wide"><i class="fa-solid fa-filter mr-2"></i>Filtros de Búsqueda</h2>
                <span id="results-count" class="text-xs bg-slate-100 text-slate-600 px-2 py-1 rounded-full">3 candidatos</span>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-12 gap-4">
                <div class="md:col-span-5">
                    <label class="block text-xs font-medium text-slate-500 mb-1">Nombre o Apellidos</label>
                    <div class="relative">
                        <i class="fa-solid fa-magnifying-glass absolute left-3 top-3 text-slate-400"></i>
                        <input type="text" id="searchName" placeholder="Ej: Ana García..." class="pl-10 border border-slate-300 p-2 rounded w-full focus:ring-2 focus:ring-blue-500 focus:outline-none transition" onkeyup="renderApp()">
                    </div>
                </div>
                
                <div class="md:col-span-4">
                    <label class="block text-xs font-medium text-slate-500 mb-1">Filtro Avanzado</label>
                    <select id="filterField" class="border border-slate-300 p-2 rounded w-full focus:ring-2 focus:ring-blue-500 focus:outline-none bg-white transition" onchange="renderApp()">
                        <option value="all">Todas las especialidades</option>
                        
                        <optgroup label="Experiencia Laboral">
                            <option value="gerencia">Alta Gerencia</option>
                            <option value="extranjero">Exp. Internacional</option>
                        </optgroup>
                        
                        <optgroup label="Consejos de Administración">
                            <option value="consejero_publica">Empresa Pública</option>
                            <option value="consejero_privada">Empresa Privada</option>
                            <option value="consejero_familiar">Empresa Familiar</option>
                        </optgroup>
                        
                        <optgroup label="Áreas de Expertise">
                            <option value="inteligencia_artificial">IA / Tech</option>
                            <option value="finanzas">Finanzas</option>
                            <option value="legal">Legal / Regulatorio</option>
                            <option value="ciberseguridad">Ciberseguridad</option>
                            <option value="sostenibilidad">Sostenibilidad (ESG)</option>
                            <option value="energia">Energía</option>
                            <option value="banca">Banca</option>
                        </optgroup>
                    </select>
                </div>
                
                <div class="md:col-span-3">
                    <label class="block text-xs font-medium text-slate-500 mb-1">Mínimo Años</label>
                    <div class="flex items-center">
                        <input type="number" id="minYears" value="0" min="0" max="50" class="border border-slate-300 p-2 rounded w-20 focus:ring-2 focus:ring-blue-500 focus:outline-none transition mr-2" onchange="renderApp()">
                        <span class="text-sm text-slate-600">años</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Grid de Tarjetas -->
    <main class="flex-grow container mx-auto px-4 py-8">
        <div id="cards-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
            <!-- Las tarjetas se generan dinámicamente -->
        </div>
        
        <!-- Estado vacío -->
        <div id="empty-state" class="hidden text-center py-20">
            <div class="bg-slate-100 rounded-full w-20 h-20 flex items-center justify-center mx-auto mb-4">
                <i class="fa-solid fa-user-slash text-3xl text-slate-400"></i>
            </div>
            <h3 class="text-xl font-bold text-slate-700">No se encontraron consejeros</h3>
            <p class="text-slate-500 mt-2">Intenta ajustar los filtros de búsqueda.</p>
            <button onclick="resetFilters()" class="mt-4 text-blue-600 hover:underline font-medium">Limpiar filtros</button>
        </div>
    </main>

    <!-- Footer -->
    <footer class="bg-slate-800 text-slate-400 py-6 text-center text-sm mt-auto">
        <p>© 2024 Colegio Oficial de Ingenieros Industriales de Madrid</p>
    </footer>

    <!-- Modal de Edición -->
    <div id="edit-modal" class="fixed inset-0 bg-slate-900/70 backdrop-blur-sm hidden flex items-center justify-center z-50 p-4 transition-opacity duration-300">
        <div class="bg-white rounded-xl shadow-2xl w-full max-w-2xl max-h-[90vh] flex flex-col overflow-hidden transform scale-95 opacity-0 transition-all duration-300" id="modal-content">
            <!-- Modal Header -->
            <div class="bg-blue-900 text-white p-4 flex justify-between items-center">
                <h2 class="text-lg font-bold flex items-center">
                    <i class="fa-solid fa-user-pen mr-2"></i> Editar Consejero
                </h2>
                <button onclick="closeModal()" class="text-blue-300 hover:text-white transition">
                    <i class="fa-solid fa-xmark text-xl"></i>
                </button>
            </div>

            <!-- Modal Body -->
            <div class="p-6 overflow-y-auto">
                <form id="edit-form" class="space-y-5">
                    <input type="hidden" id="edit-id">
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-xs font-bold text-slate-600 uppercase mb-1">Nombre Completo</label>
                            <input type="text" id="edit-nombre" class="w-full border border-slate-300 bg-slate-50 p-2.5 rounded focus:ring-2 focus:ring-blue-500 outline-none transition">
                        </div>
                         <div>
                            <label class="block text-xs font-bold text-slate-600 uppercase mb-1">URL Foto</label>
                            <input type="text" id="edit-foto" class="w-full border border-slate-300 bg-slate-50 p-2.5 rounded focus:ring-2 focus:ring-blue-500 outline-none transition text-xs">
                        </div>
                    </div>
                    
                    <div>
                        <label class="block text-xs font-bold text-slate-600 uppercase mb-1">Cargos Actuales (separados por coma)</label>
                        <input type="text" id="edit-cargos" class="w-full border border-slate-300 bg-slate-50 p-2.5 rounded focus:ring-2 focus:ring-blue-500 outline-none transition">
                    </div>

                    <div>
                         <label class="block text-xs font-bold text-slate-600 uppercase mb-1">Titulaciones (separadas por coma)</label>
                        <input type="text" id="edit-titulacion" class="w-full border border-slate-300 bg-slate-50 p-2.5 rounded focus:ring-2 focus:ring-blue-500 outline-none transition">
                    </div>

                    <div class="bg-blue-50 p-4 rounded-lg border border-blue-100">
                        <div class="flex justify-between items-center mb-2">
                            <label class="block text-xs font-bold text-blue-800 uppercase">
                                <i class="fa-solid fa-code mr-1"></i> Datos de Experiencia (JSON)
                            </label>
                            <span class="text-[10px] bg-blue-200 text-blue-800 px-2 py-0.5 rounded">Formato Avanzado</span>
                        </div>
                        <p class="text-xs text-blue-600 mb-2 leading-relaxed">
                            Edita los periodos. Usa <code>null</code> en "fin" para indicar que el cargo continúa actualmente (se calcularán los años automáticamente).
                        </p>
                        <textarea id="edit-experiencia" rows="8" class="w-full border border-blue-200 p-3 rounded font-mono text-xs text-slate-700 bg-white focus:ring-2 focus:ring-blue-500 outline-none"></textarea>
                    </div>
                </form>
            </div>

            <!-- Modal Footer -->
            <div class="p-4 bg-slate-50 border-t border-slate-200 flex justify-end space-x-3">
                <button type="button" onclick="closeModal()" class="px-5 py-2.5 text-slate-600 hover:text-slate-800 hover:bg-slate-200 rounded font-medium transition">Cancelar</button>
                <button type="button" onclick="saveEdits()" class="px-5 py-2.5 bg-blue-900 text-white rounded shadow-md hover:bg-blue-800 transform hover:-translate-y-0.5 transition font-medium">
                    <i class="fa-solid fa-floppy-disk mr-2"></i>Guardar Cambios
                </button>
            </div>
        </div>
    </div>

    <!-- Contenedor de Notificaciones -->
    <div id="notification-container" class="fixed bottom-5 right-5 z-50 flex flex-col gap-2"></div>

    <script>
        // --- 1. DATOS INICIALES ---
        const defaultData = [
            {
                id: 1,
                nombre: "Ana García Pérez",
                foto: "https://randomuser.me/api/portraits/women/44.jpg",
                genero: "M",
                titulacion: ["Ingeniera Industrial", "MBA IESE"],
                cargos: ["Consejera Indep. Red Eléctrica", "CEO GreenTech"],
                experiencia: {
                    "energia": [{ inicio: 2005, fin: 2015 }, { inicio: 2018, fin: null }],
                    "finanzas": [{ inicio: 2010, fin: 2015 }],
                    "sostenibilidad": [{ inicio: 2015, fin: null }],
                    "consejero_publica": [{ inicio: 2020, fin: null }],
                    "consejero_privada": [{ inicio: 2018, fin: null }]
                }
            },
            {
                id: 2,
                nombre: "Carlos Ruiz de la Torre",
                foto: "https://randomuser.me/api/portraits/men/32.jpg",
                genero: "H",
                titulacion: ["Ingeniero de Telecomunicación", "PhD IA"],
                cargos: ["CTO Banco Futuro", "Patrón Fundación Innovación"],
                experiencia: {
                    "banca": [{ inicio: 2010, fin: null }],
                    "inteligencia_artificial": [{ inicio: 2000, fin: 2010 }, { inicio: 2015, fin: null }],
                    "ciberseguridad": [{ inicio: 2018, fin: null }],
                    "gerencia": [{ inicio: 2015, fin: null }]
                }
            },
            {
                id: 3,
                nombre: "Elena M. Strogonoff",
                foto: "https://randomuser.me/api/portraits/women/68.jpg",
                genero: "M",
                titulacion: ["Ingeniera de Caminos", "PADE", "Derecho"],
                cargos: ["Consejera Constructora S.A."],
                experiencia: {
                    "extranjero": [{ inicio: 1998, fin: 2010 }],
                    "gerencia": [{ inicio: 2005, fin: null }],
                    "consejero_privada": [{ inicio: 2015, fin: null }],
                    "consejero_familiar": [{ inicio: 2010, fin: 2015 }],
                    "legal": [{ inicio: 2000, fin: 2005 }]
                }
            },
            {
                id: 4,
                nombre: "Javier Méndez",
                foto: "https://randomuser.me/api/portraits/men/85.jpg",
                genero: "H",
                titulacion: ["Economista", "CFA", "Máster Finanzas"],
                cargos: ["CFO Global Motors", "Advisor Fintech Startup"],
                experiencia: {
                    "finanzas": [{ inicio: 1995, fin: null }],
                    "banca": [{ inicio: 2000, fin: 2010 }],
                    "extranjero": [{ inicio: 2010, fin: 2018 }],
                    "gerencia": [{ inicio: 2018, fin: null }],
                    "consejero_familiar": [{ inicio: 2020, fin: null }]
                }
            }
        ];

        let alumnos = [...defaultData];
        let isEditMode = false;

        // --- 2. LÓGICA DE CÁLCULO (Motor) ---

        function calculateTotalYears(periods) {
            if (!periods) return 0;
            let totalDays = 0;
            const now = new Date();

            periods.forEach(p => {
                const start = new Date(p.inicio, 0, 1);
                const end = p.fin ? new Date(p.fin, 11, 31) : now;
                if (start > now) return;
                const diffTime = Math.max(0, end - start);
                const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24)); 
                totalDays += diffDays;
            });

            return Math.floor(totalDays / 365);
        }

        // --- 3. ESTILOS DE TITULACIONES ---
        
        function getDegreeStyle(title) {
            const t = title.toLowerCase();
            
            if (t.includes('ingenier') || t.includes('telecom') || t.includes('caminos') || t.includes('industrial') || t.includes('informát')) {
                return { icon: "fa-gears", css: "bg-blue-50 text-blue-700 border-blue-200" };
            }
            if (t.includes('mba') || t.includes('ade') || t.includes('business') || t.includes('pade') || t.includes('dirección')) {
                return { icon: "fa-user-tie", css: "bg-emerald-50 text-emerald-700 border-emerald-200" };
            }
            if (t.includes('econom') || t.includes('financ') || t.includes('cfa')) {
                return { icon: "fa-chart-pie", css: "bg-amber-50 text-amber-700 border-amber-200" };
            }
            if (t.includes('derecho') || t.includes('leyes') || t.includes('jurídic') || t.includes('abogad')) {
                return { icon: "fa-scale-balanced", css: "bg-red-50 text-red-700 border-red-200" };
            }
            if (t.includes('phd') || t.includes('doctor') || t.includes('ciencias') || t.includes('física')) {
                return { icon: "fa-microscope", css: "bg-violet-50 text-violet-700 border-violet-200" };
            }
            return { icon: "fa-graduation-cap", css: "bg-slate-50 text-slate-600 border-slate-200" };
        }

        // --- 4. CONFIGURACIÓN VISUAL SKILLS ---
        
        // Estructura de Grupos para renderizado
        const skillGroups = [
            {
                title: "Experiencia Laboral",
                keys: ["gerencia", "extranjero"]
            },
            {
                title: "Experiencia en Consejos",
                keys: ["consejero_publica", "consejero_privada", "consejero_familiar"]
            },
            {
                title: "Áreas de Expertise",
                keys: ["inteligencia_artificial", "finanzas", "legal", "ciberseguridad", "sostenibilidad", "energia", "banca"]
            }
        ];

        // Diccionario visual de skills (Añadido 'legal' y 'consejero_familiar')
        const skillConfig = {
            "gerencia": { icon: "fa-briefcase", color: "bg-blue-800", text: "text-blue-800", label: "Alta Gerencia" },
            "extranjero": { icon: "fa-globe", color: "bg-cyan-500", text: "text-cyan-700", label: "Exp. Internac." },
            
            "consejero_publica": { icon: "fa-landmark", color: "bg-orange-600", text: "text-orange-700", label: "Cons. Público" },
            "consejero_privada": { icon: "fa-building", color: "bg-indigo-600", text: "text-indigo-700", label: "Cons. Privado" },
            "consejero_familiar": { icon: "fa-people-roof", color: "bg-rose-500", text: "text-rose-700", label: "Cons. Familiar" },
            
            "inteligencia_artificial": { icon: "fa-brain", color: "bg-violet-600", text: "text-violet-700", label: "IA / Tech" },
            "finanzas": { icon: "fa-chart-line", color: "bg-emerald-600", text: "text-emerald-700", label: "Finanzas" },
            "legal": { icon: "fa-scale-balanced", color: "bg-stone-600", text: "text-stone-700", label: "Legal" },
            "ciberseguridad": { icon: "fa-shield-halved", color: "bg-red-600", text: "text-red-700", label: "Ciberseguridad" },
            "sostenibilidad": { icon: "fa-leaf", color: "bg-lime-500", text: "text-lime-700", label: "ESG" },
            "energia": { icon: "fa-bolt", color: "bg-amber-500", text: "text-amber-700", label: "Energía" },
            "banca": { icon: "fa-building-columns", color: "bg-slate-600", text: "text-slate-700", label: "Banca" }
        };

        // --- 5. RENDERIZADO (Vista) ---

        function renderApp() {
            const container = document.getElementById('cards-container');
            const emptyState = document.getElementById('empty-state');
            const resultCount = document.getElementById('results-count');
            
            container.innerHTML = '';

            const searchTerm = document.getElementById('searchName').value.toLowerCase();
            const filterField = document.getElementById('filterField').value;
            const minYears = parseInt(document.getElementById('minYears').value) || 0;

            let visibleCount = 0;

            alumnos.forEach(alumno => {
                // Filtrado
                const nameMatch = alumno.nombre.toLowerCase().includes(searchTerm) || 
                                  alumno.cargos.some(c => c.toLowerCase().includes(searchTerm));
                
                if (!nameMatch) return;
                
                let yearsInFilter = 0;
                if (filterField !== 'all') {
                    if (!alumno.experiencia[filterField]) return; 
                    yearsInFilter = calculateTotalYears(alumno.experiencia[filterField]);
                    if (yearsInFilter < minYears) return;
                } else {
                    if (minYears > 0) {
                        const maxExp = Object.values(alumno.experiencia).reduce((max, periods) => {
                            return Math.max(max, calculateTotalYears(periods));
                        }, 0);
                        if (maxExp < minYears) return;
                    }
                }

                visibleCount++;

                const card = document.createElement('div');
                card.className = "bg-white rounded-xl shadow-sm border border-slate-100 p-5 flex flex-col h-full card-hover relative group";
                
                const editBtnDisplay = isEditMode ? 'flex' : 'none';
                
                // Cargos
                let rolesHtml = alumno.cargos.map(c => 
                    `<span class="text-[10px] font-bold uppercase tracking-wide bg-slate-50 text-slate-600 px-2 py-1 rounded mr-1 mb-1 inline-block border border-slate-200 truncate max-w-full">${c}</span>`
                ).join('');
                
                // Titulaciones
                let titulosHtml = alumno.titulacion.map(t => {
                    const style = getDegreeStyle(t);
                    return `
                        <div class="inline-flex items-center px-2 py-0.5 rounded-md text-[10px] font-medium mr-1 mb-1 border ${style.css} transition-colors">
                            <i class="fa-solid ${style.icon} mr-1.5 opacity-80"></i>${t}
                        </div>
                    `;
                }).join('');

                // --- Generación del Bloques de Skills por Grupos ---
                let skillsHtml = '<div class="mt-auto space-y-3 pt-2">';
                
                skillGroups.forEach(group => {
                    // Título de grupo
                    skillsHtml += `
                        <div>
                            <div class="flex items-center space-x-2 mb-2">
                                <span class="text-[9px] font-bold uppercase tracking-wider text-slate-400">${group.title}</span>
                                <div class="h-px bg-slate-100 flex-grow"></div>
                            </div>
                            <div class="grid grid-cols-2 gap-x-3 gap-y-2">
                    `;

                    // Items del grupo
                    group.keys.forEach(key => {
                        const conf = skillConfig[key];
                        const years = alumno.experiencia[key] ? calculateTotalYears(alumno.experiencia[key]) : 0;
                        const hasExp = years > 0;
                        const opacityClass = hasExp ? "opacity-100" : "opacity-30 grayscale";
                        const yearText = hasExp ? `${years}a` : "-";
                        const percent = Math.min((years / 25) * 100, 100); 

                        skillsHtml += `
                            <div class="flex flex-col group/skill ${opacityClass} transition-opacity duration-300">
                                <div class="flex items-center justify-between text-[10px] mb-0.5">
                                    <span class="font-bold ${conf.text} truncate pr-1 flex items-center" title="${conf.label}">
                                        <i class="fa-solid ${conf.icon} mr-1 w-3 text-center"></i>${conf.label}
                                    </span>
                                    <span class="text-slate-500 font-mono text-[9px]">${yearText}</span>
                                </div>
                                <div class="exp-bar-bg bg-slate-100">
                                    <div class="exp-bar-fill ${conf.color}" style="width: ${percent}%;"></div>
                                </div>
                            </div>
                        `;
                    });

                    skillsHtml += `</div></div>`; // Cierre grid y grupo
                });
                
                skillsHtml += '</div>';

                card.innerHTML = `
                    <button onclick="openEditModal(${alumno.id})" style="display: ${editBtnDisplay}" class="absolute -top-3 -right-3 bg-white text-blue-600 hover:text-white hover:bg-blue-600 border border-blue-100 shadow-md p-3 rounded-full transition-all z-10 w-10 h-10 items-center justify-center">
                        <i class="fa-solid fa-pen"></i>
                    </button>

                    <div class="flex items-center space-x-4 mb-4">
                        <div class="relative shrink-0">
                            <img src="${alumno.foto}" alt="${alumno.nombre}" class="w-16 h-16 rounded-full border-2 border-white shadow-md object-cover bg-slate-100">
                            ${isEditMode ? '<div class="absolute inset-0 bg-black bg-opacity-20 rounded-full flex items-center justify-center text-white text-xs font-bold opacity-0 group-hover:opacity-100 transition">ID:'+alumno.id+'</div>' : ''}
                        </div>
                        <div class="flex-1 min-w-0">
                            <h3 class="font-bold text-base text-slate-800 leading-tight truncate mb-1" title="${alumno.nombre}">${alumno.nombre}</h3>
                            <div class="flex flex-wrap">${rolesHtml}</div>
                        </div>
                    </div>
                    
                    <div class="mb-3 flex flex-wrap min-h-[2.5rem] content-start">
                        ${titulosHtml}
                    </div>
                    
                    ${skillsHtml}
                `;

                container.appendChild(card);
            });

            resultCount.textContent = `${visibleCount} candidato${visibleCount !== 1 ? 's' : ''}`;
            if (visibleCount === 0) {
                container.classList.add('hidden');
                emptyState.classList.remove('hidden');
            } else {
                container.classList.remove('hidden');
                emptyState.classList.add('hidden');
            }
        }

        function resetFilters() {
            document.getElementById('searchName').value = '';
            document.getElementById('filterField').value = 'all';
            document.getElementById('minYears').value = 0;
            renderApp();
        }

        // --- 6. GESTIÓN DE EDICIÓN Y ARCHIVOS ---

        function toggleEditMode() {
            isEditMode = !isEditMode;
            const btn = document.getElementById('btn-mode');
            const fileActions = document.getElementById('file-actions');
            
            if (isEditMode) {
                btn.innerHTML = '<i class="fa-solid fa-eye mr-2"></i> Modo Visor';
                btn.classList.remove('bg-blue-800', 'border-blue-700');
                btn.classList.add('bg-slate-700', 'border-slate-600', 'hover:bg-slate-600');
                fileActions.classList.remove('hidden');
                showNotification("Modo Edición activado", "info");
            } else {
                btn.innerHTML = '<i class="fa-solid fa-pen-to-square mr-2"></i> Modo Edición';
                btn.classList.add('bg-blue-800', 'border-blue-700');
                btn.classList.remove('bg-slate-700', 'border-slate-600', 'hover:bg-slate-600');
                fileActions.classList.add('hidden');
            }
            renderApp();
        }

        function openEditModal(id) {
            const alumno = alumnos.find(a => a.id === id);
            if (!alumno) return;

            document.getElementById('edit-id').value = alumno.id;
            document.getElementById('edit-nombre').value = alumno.nombre;
            document.getElementById('edit-foto').value = alumno.foto;
            document.getElementById('edit-cargos').value = alumno.cargos.join(', ');
            document.getElementById('edit-titulacion').value = alumno.titulacion.join(', ');
            document.getElementById('edit-experiencia').value = JSON.stringify(alumno.experiencia, null, 4);
            
            const modal = document.getElementById('edit-modal');
            const content = document.getElementById('modal-content');
            modal.classList.remove('hidden');
            setTimeout(() => {
                modal.classList.remove('backdrop-blur-sm');
                content.classList.remove('scale-95', 'opacity-0');
                content.classList.add('scale-100', 'opacity-100');
            }, 10);
        }

        function closeModal() {
            const modal = document.getElementById('edit-modal');
            const content = document.getElementById('modal-content');
            
            content.classList.remove('scale-100', 'opacity-100');
            content.classList.add('scale-95', 'opacity-0');
            
            setTimeout(() => {
                modal.classList.add('hidden');
            }, 300);
        }

        function saveEdits() {
            const id = parseInt(document.getElementById('edit-id').value);
            const nombre = document.getElementById('edit-nombre').value;
            const foto = document.getElementById('edit-foto').value;
            const cargos = document.getElementById('edit-cargos').value.split(',').map(s => s.trim()).filter(s => s);
            const titulacion = document.getElementById('edit-titulacion').value.split(',').map(s => s.trim()).filter(s => s);
            
            try {
                const experiencia = JSON.parse(document.getElementById('edit-experiencia').value);
                
                const index = alumnos.findIndex(a => a.id === id);
                if (index !== -1) {
                    alumnos[index] = { ...alumnos[index], nombre, foto, cargos, titulacion, experiencia };
                    
                    closeModal();
                    renderApp();
                    showNotification("Cambios aplicados correctamente", "success");
                }
            } catch (e) {
                showNotification("Error: JSON de experiencia inválido", "error");
            }
        }

        function exportData() {
            const dataStr = JSON.stringify(alumnos, null, 2);
            const blob = new Blob([dataStr], { type: "application/json" });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = `consejeros_coiim_${new Date().toISOString().slice(0,10)}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showNotification("Archivo JSON generado", "success");
        }

        function importData(inputElement) {
            const file = inputElement.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const json = JSON.parse(e.target.result);
                    if (Array.isArray(json)) {
                        alumnos = json;
                        renderApp();
                        showNotification("Base de datos actualizada", "success");
                    } else {
                        showNotification("El archivo no tiene el formato correcto", "error");
                    }
                } catch (error) {
                    showNotification("Error al leer el archivo JSON", "error");
                }
                inputElement.value = '';
            };
            reader.readAsText(file);
        }
        
        function showNotification(message, type = 'info') {
            const container = document.getElementById('notification-container');
            const notif = document.createElement('div');
            
            let bgClass, icon;
            if (type === 'success') {
                bgClass = 'bg-green-600';
                icon = 'fa-check-circle';
            } else if (type === 'error') {
                bgClass = 'bg-red-600';
                icon = 'fa-circle-exclamation';
            } else {
                bgClass = 'bg-blue-600';
                icon = 'fa-circle-info';
            }

            notif.className = `${bgClass} text-white px-6 py-3 rounded-lg shadow-lg flex items-center gap-3 notification transform transition-all duration-300`;
            notif.innerHTML = `
                <i class="fa-solid ${icon}"></i>
                <span class="font-medium text-sm">${message}</span>
            `;

            container.appendChild(notif);

            setTimeout(() => {
                notif.style.opacity = '0';
                notif.style.transform = 'translateY(10px)';
                setTimeout(() => notif.remove(), 300);
            }, 3000);
        }

        renderApp();

    </script>
</body>
</html>
